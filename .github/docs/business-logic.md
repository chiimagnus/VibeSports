# VibeSports 业务逻辑说明

## 1. 文档定位

本文只描述业务目标、业务规则与验收口径，不记录实现细节（代码结构、类设计、技术参数、API 调用等）。

技术实现说明统一放在 `AGENTS.md` 体系中维护（按目录分层维护）。

## 2. 产品目标

VibeSports 是一个“摄像头跑步游戏”：

- 用户在摄像头前原地跑步；
- 系统估计用户跑步节奏；
- 3D 场景与 3D 角色动作随用户节奏变化；
- 用户获得即时反馈（速度、步数、动作状态）。

当前优先级是“动作同步感”优先于“真实速度精度”。

## 3. 核心业务流程

1. 待机：用户进入主界面，可看到游戏画面与摄像头区域。  
2. 开始：用户点击开始后进入会话，系统开始持续接收人体动作输入。  
3. 运行：系统持续更新步频、步数、速度，并驱动场景前进与角色动画。  
4. 停止：用户结束会话后，状态回到待机，指标归零，资源释放。  

## 4. 业务状态定义

- 会话状态：`Idle`、`Running`、`Stopped`（实现上可与 `Idle` 合并表现）。  
- 运动状态：`Idle 动画`、`SlowRun 动画`、`FastRun 动画`，按运动强度连续过渡。  
- 输入状态：有人体输入 / 无人体输入。无输入持续一段时间后应平滑回到 idle。  

## 5. 指标口径（业务）

- `step`：`stepCount` 每增加 1 记为 1 step。  
- `cadence`：单位时间内的 step 数（可同时提供 steps/s 与 steps/min）。  
- `speed`：由 cadence 推导的“游戏速度”，用于驱动场景前进与动画节奏。  
- `movementQuality`：动作有效性指标，用于抑制噪声与误触发。  
- `closeUpMode`：用户离镜头较近时启用的业务模式，用于保持动作识别可用性。  

## 6. 动画与场景业务规则

- 角色动画使用三段跑步状态（Idle / SlowRun / FastRun）连续混合。  
- 动画播放节奏应跟随用户 cadence 变化，避免“人慢跑、角色飞奔”的割裂感。  
- 场景推进速度与动画节奏保持一致来源，避免视觉与数值脱节。  
- 当用户停止动作时，角色与场景应在短时间内回落到 idle，而非突变。  

## 7. Debug 业务能力

面向调试与校准，当前提供以下业务能力：

- 可开关姿态叠加显示；
- 可切换镜像预览；
- 可开关姿态稳定化显示；
- 可查看动画片段是否存在并可播放；
- 可实时调节动作同步相关业务参数（如步幅映射、动画步数映射、平滑与回落时间）。

## 8. 持久化业务项

当前只持久化用户偏好类开关：

- 是否显示姿态叠加；
- 是否镜像摄像头预览；
- 是否启用姿态稳定化显示。

## 9. 非目标（当前阶段）

- 不做实时骨骼动捕映射（真人骨骼逐关节驱动 3D 骨骼）；  
- 不追求医疗/竞技级速度精度；  
- 不恢复体重/热量等已移除业务。  

## 10. 验收口径

- 正常跑步时，角色动作节奏与真人节奏一致，不出现明显“过快飞奔”；  
- 停止跑步后，角色与场景在可接受时间内回到 idle；  
- Debug 调参可即时生效，支持现场校准；  
- 会话开始/结束行为稳定，结束后不残留运行态资源。  
